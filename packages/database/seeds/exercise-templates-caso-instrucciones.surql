-- ============================================================================
-- SEED: Exercise Templates - Caso & Instrucciones
-- Este script crea √∫nicamente los dos nuevos tipos de ejercicios
--   1. Caso de An√°lisis
--   2. Instrucciones de Actividad
-- ============================================================================

-- 11. CASO DE AN√ÅLISIS
CREATE exercise_template:caso CONTENT {
    nombre: "Caso de An√°lisis",
    categoria: "caso",
    descripcion: "Instrumento de aprendizaje basado en an√°lisis situacional que presenta una narrativa rica de una situaci√≥n real o realista para desarrollar juicio profesional contextualizado.",
    objetivo_pedagogico: "Desarrollar la capacidad de aplicar frameworks conceptuales a situaciones ambiguas del mundo real, identificando factores causales, evaluando decisiones y proponiendo alternativas justificadas.",
    rol_ia: "Consultor socr√°tico que no da respuestas, sino que cuestiona el razonamiento del estudiante (\"¬øQu√© evidencia del caso sustenta tu afirmaci√≥n?\", \"¬øConsideraste estas restricciones?\") para desarrollar rigor anal√≠tico y pensamiento multidimensional.",
    icono: "‚öñÔ∏è",
    color: "#d946ef",
    configuracion_schema: {
        type: "object",
        properties: {
            narrativa_caso: {
                type: "string",
                description: "Narrativa completa del caso (historia, datos, protagonistas)"
            },
            preguntas_analisis: {
                type: "array",
                description: "Preguntas estructuradas que gu√≠an el an√°lisis del estudiante.",
                items: {
                    type: "object",
                    properties: {
                        pregunta_guia: {
                            type: "string",
                            description: "Pregunta para el estudiante (Ej: \"Identifica el problema central\")"
                        },
                        criterios_ia: {
                            type: "string",
                            description: "Criterios que la IA usar√° para evaluar la respuesta del estudiante"
                        }
                    }
                }
            }
        },
        required: ["narrativa_caso"]
    },
    configuracion_default: {
        preguntas_analisis: []
    },
    prompt_template: "Eres un dise√±ador instruccional experto creando un Caso de An√°lisis interactivo.\n\nCONTEXTO DEL PROGRAMA:\n{{programa.nombre}}, Fase: {{fase.nombre}}\nProof Point: {{proof_point.pregunta_central}}\n\nNARRATIVA BASE PROPORCIONADA:\n{{configuracion.narrativa_caso}}\n\nPREGUNTAS DE AN√ÅLISIS DEFINIDAS POR INSTRUCTOR:\n{{#each configuracion.preguntas_analisis}}\n- Pregunta: {{pregunta_guia}}\n- Criterios IA: {{criterios_ia}}\n{{/each}}\n\nREQUISITOS DE FORMATO:\n- El output debe ser un JSON que siga el output_schema.\n- El campo \"narrativa_markdown\" debe contener la historia del caso, formateada con H2/H3 y :::callouts para datos clave.\n- El campo \"secciones_analisis\" debe tomar las \"preguntas_analisis\" del instructor y convertirlas en secciones de un cuaderno de trabajo, detallando qu√© debe hacer el estudiante.\n\nOUTPUT ESPERADO (JSON):\n{{output_schema}}\n\nIMPORTANTE: Devuelve √∫nicamente JSON v√°lido.",
    output_schema: {
        titulo: "string",
        narrativa_markdown: "string (La historia del caso formateada)",
        metadata: {
            conceptosClave: ["string"],
            tiempoEstimadoMinutos: "number"
        },
        secciones_analisis: [{
            id: "string",
            titulo: "string (Basado en la pregunta_guia)",
            instrucciones: "string (Instrucci√≥n clara para el estudiante)",
            placeholder: "string (Ej: \"Escribe tu an√°lisis aqu√≠...\")",
            criterios_evaluacion_ia: ["string (Basado en criterios_ia)"]
        }]
    },
    preview_config: {
        mostrar_progreso: true,
        tiempo_estimado_minutos: 45
    },
    es_oficial: true,
    activo: true
};

-- 12. INSTRUCCIONES DE ACTIVIDAD
CREATE exercise_template:instrucciones CONTENT {
    nombre: "Instrucciones de Actividad",
    categoria: "instrucciones",
    descripcion: "Gu√≠a procedimental paso a paso para ejecutar actividades de aprendizaje aut√©nticas fuera de la plataforma (entrevistas, prototipos f√≠sicos, experimentos).",
    objetivo_pedagogico: "Proporcionar andamiaje procedimental y soporte \"just-in-time\" para que el estudiante navegue exitosamente actividades en el mundo real.",
    rol_ia: "Coaching as√≠ncrono que ayuda al estudiante a preparar la actividad (\"¬øQu√© preguntas priorizo?\"), consultar durante (\"¬øC√≥mo respondo a esta objeci√≥n?\"), y reflexionar despu√©s (\"¬øMi approach fue correcto?\") usando el contexto del objetivo de la actividad.",
    icono: "üìã",
    color: "#f97316",
    configuracion_schema: {
        type: "object",
        properties: {
            objetivo_actividad: {
                type: "string",
                description: "Qu√© debe lograr el estudiante con esta actividad en el mundo real"
            },
            contexto_ia: {
                type: "string",
                description: "Contexto clave para el Asistente IA (Ej: \"El estudiante va a entrevistar a un cliente B2B dif√≠cil\")"
            },
            checklists_preparacion: {
                type: "array",
                description: "Listas de verificaci√≥n (pre, durante, post)",
                items: {
                    type: "object",
                    properties: {
                        titulo: {
                            type: "string",
                            description: "Ej: \"Antes de la Entrevista\""
                        },
                        items: {
                            type: "array",
                            items: { type: "string" }
                        }
                    }
                }
            }
        },
        required: ["objetivo_actividad", "contexto_ia"]
    },
    configuracion_default: {
        checklists_preparacion: []
    },
    prompt_template: "Eres un dise√±ador instruccional experto creando una gu√≠a de instrucciones para una actividad aut√©ntica fuera de la plataforma.\n\nCONTEXTO DEL PROGRAMA:\n{{programa.nombre}}, Fase: {{fase.nombre}}\nProof Point: {{proof_point.pregunta_central}}\n\nDEFINICI√ìN DE LA ACTIVIDAD (Instructor):\n- Objetivo: {{configuracion.objetivo_actividad}}\n- Contexto para IA: {{configuracion.contexto_ia}}\n- Checklists: {{configuracion.checklists_preparacion}}\n\nREQUISITOS DE FORMATO:\n- El output debe ser un JSON que siga el output_schema.\n- Genera un \"resumen_mision\" claro.\n- Detalla los \"pasos_ejecucion\" (inferidos del objetivo).\n- Formatea los \"checklists\" proporcionados.\n- Genera 3 \"preguntas_asistencia_sugeridas\" que el estudiante podr√≠a hacerle a la IA (Ej: \"Ay√∫dame a preparar mis preguntas de apertura\").\n\nOUTPUT ESPERADO (JSON):\n{{output_schema}}\n\nIMPORTANTE: Devuelve √∫nicamente JSON v√°lido.",
    output_schema: {
        titulo: "string",
        resumen_mision: "string (Descripci√≥n clara del objetivo)",
        pasos_ejecucion: [{
            id: "string",
            nombre: "string",
            descripcion: "string"
        }],
        checklists: [{
            titulo: "string",
            items: [{ id: "string", texto: "string", completado: "boolean" }]
        }],
        preguntas_asistencia_sugeridas: ["string"]
    },
    preview_config: {
        autoguardado: false,
        mostrar_progreso_secciones: true
    },
    es_oficial: true,
    activo: true
};
