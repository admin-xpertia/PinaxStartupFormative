# Developer Onboarding Guide

**Last Updated:** 2025-11-06

Welcome to the Xpertia Platform development team! This guide will help you get up to speed with our codebase, architecture, and development workflow.

---

## Table of Contents

1. [Quick Start](#quick-start)
2. [Architecture Overview](#architecture-overview)
3. [Project Structure](#project-structure)
4. [Development Workflow](#development-workflow)
5. [Key Concepts](#key-concepts)
6. [Common Tasks](#common-tasks)
7. [Important Notes](#important-notes)

---

## Quick Start

### Prerequisites
- Node.js 20+
- pnpm 8+
- SurrealDB 1.0+

### Setup
```bash
# Clone repository
git clone <repository-url>
cd xpertia-plataforma

# Install dependencies
pnpm install

# Setup database
cd packages/database
./init-schema.sh

# Start development servers
pnpm dev
```

---

## Architecture Overview

### Current System (2025-11-06)

The platform uses a **simplified 3-level hierarchy** with flexible exercise templates:

```
Programa (Program)
  â””â”€ Fase (Phase)
      â””â”€ ProofPoint (Learning Milestone)
          â””â”€ ExerciseInstance (Template-based exercise)
```

#### Key Components

1. **ExerciseTemplate**: Catalog of 10+ exercise types
   - LecciÃ³n Interactiva (Interactive Lesson)
   - Cuaderno de Trabajo (Workbook)
   - SimulaciÃ³n de InteracciÃ³n (Simulation)
   - Mentor Asesor IA (AI Mentor)
   - And 6 more...

2. **ExerciseInstance**: Applied template to a specific proof point
   - Linked to a template
   - Custom configuration per instance
   - AI-generated content

3. **ExerciseContent**: The actual content generated by AI
   - Stored as JSON
   - Version tracked
   - Can be regenerated

### âš ï¸ Legacy System (Deprecated)

You may encounter references to the old **5-level hierarchy** system. This has been **deprecated and removed**:

```
âŒ Programa â†’ Fase â†’ ProofPoint â†’ Nivel â†’ Componente (DEPRECATED)
```

**If you see these terms, they are legacy:**
- `componente` / `Componente`
- `nivel` / `Nivel`
- `/api/v1/componentes/*` endpoints
- `ComponentesService`, `ComponentesController`

**Migration:** See [API_MIGRATION_GUIDE.md](./API_MIGRATION_GUIDE.md) for details.

---

## Project Structure

```
xpertia-plataforma/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                    # NestJS Backend API
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ domains/
â”‚   â”‚           â”œâ”€â”€ ejercicios/     # âœ… Exercise system (NEW)
â”‚   â”‚           â”œâ”€â”€ generacion/     # AI content generation
â”‚   â”‚           â”œâ”€â”€ programas/      # Program management
â”‚   â”‚           â””â”€â”€ contenido/      # Content management
â”‚   â”‚
â”‚   â””â”€â”€ instructor-app/         # Next.js Frontend
â”‚       â”œâ”€â”€ app/                # App router pages
â”‚       â”œâ”€â”€ components/         # React components
â”‚       â”‚   â”œâ”€â”€ ejercicios/         # âœ… Exercise components (NEW)
â”‚       â”‚   â””â”€â”€ fase3/              # âŒ Legacy editors (DEPRECATED)
â”‚       â””â”€â”€ lib/                # Utilities and hooks
â”‚
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ database/               # SurrealDB schemas
â”‚       â”œâ”€â”€ schema/
â”‚       â”‚   â”œâ”€â”€ ejercicios.surql    # âœ… Exercise tables (NEW)
â”‚       â”‚   â”œâ”€â”€ contenido.surql     # Program structure
â”‚       â”‚   â””â”€â”€ generacion.surql    # AI generation
â”‚       â”œâ”€â”€ migrations/         # Database migrations
â”‚       â””â”€â”€ types.ts            # TypeScript types
â”‚
â””â”€â”€ docs/                       # Documentation
```

---

## Development Workflow

### 1. Feature Development

```bash
# Create feature branch
git checkout -b feature/your-feature-name

# Make changes and test locally
pnpm dev

# Run tests
pnpm test

# Commit with conventional commits
git commit -m "feat: add new exercise type"

# Push and create PR
git push origin feature/your-feature-name
```

### 2. Database Changes

When modifying the database schema:

```bash
# 1. Create migration file
cd packages/database/migrations
touch 003-your-migration.surql

# 2. Write migration SQL
# See existing migrations for examples

# 3. Update schema files
# Edit packages/database/schema/*.surql

# 4. Update TypeScript types
# Edit packages/database/types.ts

# 5. Test migration
./init-schema.sh
```

### 3. API Development

```bash
# Navigate to API
cd apps/api

# Generate new domain/module
nest g module domains/your-domain
nest g controller domains/your-domain
nest g service domains/your-domain

# Follow existing patterns in ejercicios/ domain
```

---

## Key Concepts

### Exercise System

The exercise system is the core of the platform. Here's how it works:

1. **Templates Define Structure**
   ```typescript
   const template = {
     nombre: "LecciÃ³n Interactiva",
     categoria: "leccion_interactiva",
     configuracion_schema: {
       duracion_estimada: { type: "number", default: 30 },
       nivel_dificultad: { type: "select", options: [...] }
     },
     prompt_template: "Create a lesson about {{topic}}..."
   };
   ```

2. **Instances Apply Templates**
   ```typescript
   const instance = {
     template: "exercise_template:leccion_interactiva",
     proof_point: "proof_point:xyz",
     nombre: "Variables in Python",
     configuracion_personalizada: {
       duracion_estimada: 45,
       nivel_dificultad: "basico"
     }
   };
   ```

3. **AI Generates Content**
   ```typescript
   // Trigger generation
   POST /api/v1/exercise-generation/:instanceId

   // Content is generated using template + configuration
   // and stored in exercise_content table
   ```

### Content Generation Flow

```
1. Instructor creates ExerciseInstance
2. System combines: Template + Config + ProofPoint context
3. AI generates content (Claude API)
4. Content stored in ExerciseContent
5. Instructor can regenerate anytime
```

---

## Common Tasks

### Creating a New Exercise Type

See [apps/api/src/domains/ejercicios/README.md](./apps/api/src/domains/ejercicios/README.md) for detailed instructions.

**Quick steps:**
1. Add template to seed data
2. Create prompt template
3. Define configuration schema
4. Implement frontend preview component

### Adding a New API Endpoint

```typescript
// 1. Add to controller
@Get(':id')
async getExerciseInstance(@Param('id') id: string) {
  return this.exerciseInstancesService.findOne(id);
}

// 2. Implement in service
async findOne(id: string) {
  const result = await this.surrealDb.query(
    'SELECT * FROM exercise_instance WHERE id = $id',
    { id }
  );
  return result[0];
}

// 3. Update frontend to use new endpoint
const response = await fetch(`/api/v1/exercise-instances/${id}`);
```

### Generating Content with AI

```typescript
// Backend: Exercise generation service
async generateContent(instanceId: string, config: GenerationConfig) {
  const instance = await this.findInstance(instanceId);
  const template = await this.getTemplate(instance.template);

  const prompt = this.buildPrompt(template, instance, config);
  const content = await this.claudeService.generate(prompt);

  return this.saveContent(instanceId, content);
}
```

---

## Important Notes

### âš ï¸ Legacy Code Warning

**Do NOT use or extend these:**
- `ComponentesService` / `ComponentesController` (deleted)
- `/api/v1/componentes/*` endpoints (removed)
- `use-contenido.ts` hook (deprecated)
- Any code in `components/fase3/` (deprecated)

**Instead, use:**
- `ExerciseInstancesService` / `ExerciseInstancesController`
- `/api/v1/exercise-instances/*` endpoints
- New exercise hooks and components

### Database Best Practices

1. **Always use migrations** for schema changes
2. **Update types.ts** when adding/modifying tables
3. **Test migrations** on empty database first
4. **Document breaking changes** in migration comments

### Code Style

- Use TypeScript strict mode
- Follow existing naming conventions
- Write tests for new features
- Use conventional commits
- Comment complex logic

### Testing

```bash
# Run all tests
pnpm test

# Run specific test file
pnpm test exercise-instances.service.spec.ts

# Run with coverage
pnpm test:cov
```

---

## Helpful Resources

- [API Migration Guide](./API_MIGRATION_GUIDE.md) - Migrating from old to new system
- [Legacy Cleanup Guide](./LEGACY_CLEANUP.md) - Understanding deprecated code
- [Exercise System README](./apps/api/src/domains/ejercicios/README.md) - Exercise implementation details
- [Database Migrations](./packages/database/migrations/README.md) - Migration documentation

---

## Getting Help

1. **Code Questions:** Check existing READMEs in relevant directories
2. **Architecture Questions:** Review this document and API_MIGRATION_GUIDE.md
3. **Legacy Code:** See LEGACY_CLEANUP.md for context
4. **Stuck?** Ask the team in Slack/Teams

---

## Next Steps

Now that you're onboarded:

1. âœ… Set up your development environment
2. âœ… Read this guide
3. ğŸ“– Review [API_MIGRATION_GUIDE.md](./API_MIGRATION_GUIDE.md)
4. ğŸ” Explore the codebase in `apps/api/src/domains/ejercicios/`
5. ğŸš€ Start with a small task or bug fix
6. ğŸ’¬ Ask questions - we're here to help!

Welcome aboard! ğŸ‰
